#!/bin/zsh
# Called by tools/setup-* to initialize a new install.

# set -x # trace cmds

data=${data:?data not set}
hs_dir=${hs_dir:?hs_dir not set}
hs_package=${hs_package:?hs_package not set}


data_dirs=(im inst_db prof save)
local_hs=(Config.hs Instrument.hs KeyLayout.hs Repl.hs ShakeConfig.hs)
non_hs=(ky)

for dir in $data_dirs; do
    mkdir -p $data/$dir
    ln -s $data/$dir
done

# Make a re-export module for each config hs.
for hs in $local_hs; do
    module=${hs%.hs}

    cat >Local/$hs <<EOF
-- Generated by $0
module Local.$module (module $hs_package.$module) where
import $hs_package.$module
EOF

done

for fn in $non_hs; do
    ln -s ../$hs_dir/$fn Local/$fn
done
