#!/usr/bin/env nix-shell
#! nix-shell -i bash --arg isCi true --attr buildEnv ../default.nix

set -eux

tools/ncpus
tools/setup-elaforge

# Use --digest instead of --modtime so caching works.
runghc Shake/Shakefile.hs --digest build/opt/shakefile
bin/mk --digest typecheck-ci

export skip_hpc=t # tell tools/run_tests to not run hpc
bin/mk --digest tests-normal
